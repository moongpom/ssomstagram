{%extends 'base.html'%}

{%block content%}
    {% load static %}
    <style>
        #userSub{
            position: absolute;
            margin-left: 700px;
            border: 1px solid black;
        }
    </style>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
           
            $("#toggle").click(function() {
                $("#userSub").slideToggle("fast"); 
            });
        });
    function deletePost() {
        var ret = confirm("ê²Œì‹œë¬¼ì„ ì‚­ì œí•©ë‹ˆë‹¤.");
        return ret;
    }

    function authMessage(){
                       alert("ìª½ì§€ëŠ” ë¡œê·¸ì¸ í•˜ì‹  ë’¤ ì´ìš©ê°€ëŠ¥í•œ ì„œë¹„ìŠ¤ ì…ë‹ˆë‹¤");
                  }
</script>
<script type="text/javascript">
    function post_like(p_id) {
        $.ajax({
            type: "GET",
            url: "{% url 'post_likes' %}", 
            data: {
                'blog_id': p_id
            }, 
            dataType: "json",
            success: function (response) {
                $('#like_count' + p_id).html(response.like_count) 
                    if (response.message == "ì¢‹ì•„ìš”") 
                {
                    $('#heart' + p_id).attr("src", "{% static 'ë¹¨ê°„í•˜íŠ¸.png' %}")
                }
                    else if (response.message == "ì¢‹ì•„ìš” ì·¨ì†Œ") 
                {
                    $('#heart' + p_id).attr("src", "{% static 'ë¹ˆí•˜íŠ¸.png' %}")
                }
            }
        })
    }

</script>
    <div class="newPost_list">
        <h5 class="title">ğŸ”” ìƒˆë¡œ ì˜¬ë¼ì˜¨ ê¸€ ğŸ””</h5>
        <hr>
        {% for unit in postList %}
            <div id="content">  
               
                    {% if unit.image %}
                        <img src={{unit.image.url}} alt='image' height="300px" width="300px">
                         
                    {% endif %}<br>
                    ì œëª©: {{unit.title}}... |
                    ê¸€ë‚´ìš©: {{unit.summary}}... |
                    <small>{{unit.pub_date}} </small>
                    <button id="toggle">ì‘ì„±ì : {{unit.writer}}</button> 
                    {% if user.is_authenticated %}
                        <button id="{{unit.id}}" onclick="post_like(this.id)">
                        {%if request.user in unit.like.all%}
                        <img class="heart" id="heart{{unit.id}}" src="{% static 'ë¹¨ê°„í•˜íŠ¸.png' %}" alt="full_heart">
                        {%else%}
                        <img class="heart" id="heart{{unit.id}}" src="{% static 'ë¹ˆí•˜íŠ¸.png' %}" alt="empty_heart">
                        {%endif%}
                    {%else%}
                    <button id="{{unit.id}}" onclick="alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤')">
                        <img class="heart" id="heart" src="{% static 'ë¹ˆí•˜íŠ¸.png' %}" alt="empty_heart">
                    </button>

                    {%endif%}
                    <span id="like_count{{unit.id}}">{{unit.like.count}}</span>
                    </button>
                    <ul id="userSub">
                        {% if user.is_authenticated %}
                        <li><a href="{% url 'newMessage' unit.writer unit.title%}" > ìª½ì§€ë³´ë‚´ê¸°</a></li>
                        
                        {% else %}
                        <li><a href='#' onclick="authMessage()" > ìª½ì§€ë³´ë‚´ê¸°</a></li>
                        
                        {%endif%}
                       
                        <li><a href="{% url 'userPage' unit.writer %}" > êµ¬ê²½ê°€ê¸°</a></li>
                    </ul>
                    <br><br> {% if user == postContents.writer %}
                    <a class="toNext" href="{% url 'deletePost' unit.id%}" onclick="return deletePost()">ì‚­ì œí•˜ê¸°</a>
                    {% elif user.is_staff%}
                    <a class="toNext" href="{% url 'deletePost' unit.id%}" onclick="return deletePost()">ì‚­ì œí•˜ê¸°</a>
                    {%endif%}
            </div>  
        {% endfor %}
    </div>


    {%endblock%}